swagger: '2.0'
x-stoplight:
  id: 33e788a295627
info:
  version: 1.1.3
  title: ASYNC CARD RECURRING CHARGES
  description: |
    <!-- theme: warning -->
    > #### To keep in mind
    >Due to our risk policies, the available payment methods and the integration type may vary once you complete the affiliation. We will tell you how to proceed if this process applies to your merchant.

    ## Using the API

    To use the API you must ask for your Kushki Sandbox, composed of a `Public-Merchant-Id` and a `Private-Merchant-Id`.

    * The current version of the Kushki API rests at: `https://api.kushkipagos.com/`
    * The testing version rests at: `https://api-uat.kushkipagos.com/`


    ## Endpoints

    We dispose various endpoints to start your payment flows, find our products available:

    * [Request a token](https://api-docs.kushkipagos.com/docs/online-payments/async-card-recurring-charges/operations/create-a-subscription-v-1-card-async-token)
    * [Init an async card recurring charge](https://api-docs.kushkipagos.com/docs/online-payments/async-card-recurring-charges/operations/create-a-subscription-v-1-card-async-init)
    * [Authorize payments](https://api-docs.kushkipagos.com/docs/online-payments/async-card-recurring-charges/operations/create-a-subscription-v-1-card-async-pre-authorization)
    * [Capture an authorized payment](https://api-docs.kushkipagos.com/docs/online-payments/async-card-recurring-charges/operations/create-a-subscription-v-1-card-async-capture)

    Once the recurring charge is created, you will be able to perform the following actions with the endpoints specified in the **card section** with the `subscriptionId` obtained in the init service: 
    * [Get the recurring charge information available](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/get-a-subscription-v-1-card-search)
    * [Make an One-click payment](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/create-a-subscription-v-1-card-1)
    * [Update a recurring charge](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/modify-a-subscription-v-1-card)
    * [Add a temporary charge or discount](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/update-a-subscription-v-1-card)
    * [Cancel a recurring charge](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/delete-a-subscription-v-1-card)



    [Return Home](/)


    > Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)
host: api-uat.kushkipagos.com
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json
securityDefinitions:
  oauth2:
    type: oauth2
    flow: implicit
    scopes: {}
    authorizationUrl: ''
paths:
  /subscriptions/v1/card-async/tokens:
    post:
      responses:
        '201':
          description: ''
          schema:
            type: object
            properties:
              token:
                type: string
                example: AbCDef123456Z7Ghi8901234jkLMNopQ
          examples:
            application/json:
              token: 477c1a2c29f24318b55d06ca7327289c
        '400':
          description: ''
          schema:
            type: object
            required:
              - code
              - message
            properties:
              code:
                type: string
                example: K001
              message:
                type: string
                example: El cuerpo de la petición es inválido
          examples:
            Invalid request body:
              code: K001
              message: Cuerpo de la petición inválido.
        '500':
          description: ''
          schema:
            type: object
            required:
              - code
              - message
            properties:
              code:
                type: string
                example: K002
              message:
                type: string
                example: Ha ocurrido un error inesperado
          examples:
            example-1:
              code: K002
              message: Ha ocurrido un error inesperado
      summary: Request an async card recurring charge token
      description: |-
        Request an async card recurring charge `token` that can later be used to create a recurring charge by calling the `init` endpoint.

        <div class="danger">
          <p><strong>Important to consider:</strong> If you include the card number in the body of the request and you are using this method from your backend, <strong>be sure to comply</strong> with all the PCI requirements to handle card data on your servers.</p>
        </div>

        <!-- theme: warning -->
        > #### Service available in the following countries:
        >
        > Chile.  
        > Check out our full [list of services by country](https://api-docs.kushkipagos.com/docs/online-payments/services-by-country)

        <!-- theme: danger -->
        > #### Token expiration
        >
        >Tokens will expire in 30 minutes and can be used only for a single transaction (even if the transaction was wrong). You will need to request a new token when it expires.

        > Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)
      operationId: cardAsyncSubscriptionToken
      parameters:
        - in: header
          name: Public-key
          type: string
          required: true
        - in: body
          name: body
          schema:
            type: object
            properties:
              currency:
                type: string
                enum:
                  - CLP
                  - UF
              email:
                type: string
              callbackUrl:
                type: string
                description: URL where the customer will return to once finalize the payment. You will get the `subscriptionId` here as a query parameter
              cardNumber:
                type: string
            required:
              - currency
              - email
              - callbackUrl
          x-examples:
            application/json:
              currency: CLP
              email: user@example.com
              callbackUrl: 'https://kushki.com'
        - type: string
          in: header
          name: Content-Type
          description: application/json
          required: true
      x-stoplight:
        id: 3meoljlhq73tb
  /subscriptions/v1/card-async/init:
    post:
      responses:
        '201':
          description: ''
          schema:
            type: object
            x-examples:
              example-1:
                redirectUrl: 'https://api-uat.kushkipagos.com/subscriptions/v1/card-async/agent/?token=165836175957500020000000108297093000&mid=20000000108297093000'
                details:
                  merchantName: Merchant CL
                  amount:
                    subtotalIva: 0
                    subtotalIva0: 20000
                    iva: 0
                    ice: 0
                    currency: CLP
                  created: 1658361765
                  email: user@example.com
                  firstName: John
                  lastName: Doe
                  merchantId: '20000000108297093000'
                  periodicity: monthly
                  planName: Premium
                  status: PENDING
                  totalAmount: 20000
                subscriptionId: '1658361759575000'
            properties:
              redirectUrl:
                type: string
              details:
                type: object
                properties:
                  merchantName:
                    type: string
                  amount:
                    $ref: ../models/Amount-CL.yaml
                  created:
                    type: integer
                  email:
                    type: string
                  firstName:
                    type: string
                  lastName:
                    type: string
                  merchantId:
                    type: string
                  periodicity:
                    type: string
                  planName:
                    type: string
                  status:
                    type: string
                  totalAmount:
                    type: number
              subscriptionId:
                type: string
          examples:
            Single response:
              redirectUrl: 'https://api-uat.kushkipagos.com/subscriptions/v1/card-async/agent/?token=164754597781800020000000108481570000&mid=20000000108481570000'
              subscriptionId: '1647545977818000'
            fullResponse v2:
              redirectUrl: 'https://api-uat.kushkipagos.com/subscriptions/v1/card-async/agent/?token=165836175957500020000000108297093000&mid=20000000108297093000'
              details:
                merchantName: Merchant CL
                amount:
                  subtotalIva: 0
                  subtotalIva0: 20000
                  iva: 0
                  ice: 0
                  currency: CLP
                created: 1658361765
                email: user@example.com
                firstName: John
                lastName: Doe
                merchantId: '20000000108297093000'
                periodicity: monthly
                planName: Premium
                status: PENDING
                totalAmount: 20000
              subscriptionId: '1658361759575000'
        '400':
          description: ''
          schema:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - code
              - message
          examples:
            Invalid request body:
              code: K001
              message: Cuerpo de la petición inválido.
            Previously used token:
              code: K022
              message: Token utilizado anteriormente
            Wrong or expired token:
              code: K008
              message: Token incorrecto o expirado
        '500':
          description: ''
          schema:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - code
              - message
          examples:
            example-1:
              code: K002
              message: Ha ocurrido un error inesperado
      summary: Init an async card recurring charge
      description: "Init the transaction with an async card recurring charge `token` provided by Kushki. The customer needs to be redirected in order to finalize the registration.\n\nOnce the recurring charge is created, you will be able to perform the following actions with the endpoints specified in the **card section**: \n* [Get the recurring charge information available](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/get-a-subscription-v-1-card-search)\n* [Make an One-click payment](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/create-a-subscription-v-1-card-1)\n* [Update a recurring charge](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/modify-a-subscription-v-1-card)\n* [Add a temporary charge or discount](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/update-a-subscription-v-1-card)\n* [Cancel a recurring charge](https://api-docs.kushkipagos.com/docs/online-payments/one-click-and-scheduled-payments/operations/delete-a-subscription-v-1-card)\n\n## Sandbox\n\nKushki allows you to simulate a full transaction. Use the following information once you are redirected:\n\n### Successful Transaction \n\n__Card number__: `4051885600446623`.<br />\n__CVV__: 123.<br />\n__Fecha de expiración__: cualquier fecha en el futuro.<br />\n__Tipo de tarjeta__: tarjeta de crédito.<br />\n__RUT__: 11.111.111-1.<br />\nContraseña: 123.<br />\n\n__Card number__: `4051884239937763`.<br />\n__CVV__: 123.<br />\n__Fecha de expiración__: cualquier fecha en el futuro.<br />\n__Tipo de tarjeta__: tarjeta de débito.<br />\n__RUT__: 11.111.111-1.<br />\nContraseña: 123.<br />\n\n__Respuesta:__ `Transacción aprobada\n\t\n### Declined Transaction \n\n__Card number__: `5186059559590568`.<br />\n__CVV__: 123.<br />\n__Fecha de expiración__: cualquier fecha en el futuro.<br />\n__Tipo de tarjeta__: tarjeta de crédito.<br />\n__RUT__: 11.111.111-1.<br />\nContraseña: 123.<br />\n\n__Card number__: `5186008541233829`.<br />\n__CVV__: 123.<br />\n__Fecha de expiración__: cualquier fecha en el futuro.<br />\n__Tipo de tarjeta__: tarjeta de débito.<br />\n__RUT__: 11.111.111-1.<br />\nContraseña: 123.<br />\n\n__Respuesta:__ `500 Rechazada`\n\n<!-- theme: warning -->\n> #### Service available in the following countries:\n>\n> Chile.  \n> Check out our full [list of services by country](https://api-docs.kushkipagos.com/docs/online-payments/services-by-country)\n\n> Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)"
      operationId: cardAsyncSubscriptionInit
      parameters:
        - in: header
          name: Private-key
          type: string
          required: true
        - in: body
          name: body
          schema:
            type: object
            properties:
              token:
                type: string
                example: AbCDef123456Z7Ghi8901234jkLMNopQ
              planName:
                type: string
                example: Premium
              periodicity:
                type: string
                enum:
                  - daily
                  - weekly
                  - biweekly
                  - monthly
                  - threefortnights
                  - bimonthly
                  - quarterly
                  - fourmonths
                  - halfYearly
                  - yearly
                  - custom
                example: monthly
                description: Use `custom` for recurring payments
              contactDetails:
                $ref: ../models/ContactDetails.yaml
              amount:
                $ref: ../models/Amount-CL.yaml
              startDate:
                type: string
                format: date
                example: '2018-09-29'
                description: |-
                  `YYYY-MM-DD` 

                  **Note:** Use future date
              endDate:
                type: string
                format: date
                example: '2022-09-29'
                description: |-
                  `YYYY-MM-DD` 

                  **Note:** Use a future date regarding to `startDate`
              language:
                $ref: ../models/Language.yaml
              retryConfiguration:
                type:
                  - object
                default: Three days in a row starting at startDate
                description: Use this object if you want to configure retries different than default
                properties:
                  retryType:
                    type: string
                    default: schedule
                    description: |-
                      **Schedule:** Specific interval to retry starting at `startDate`. **Ex.** Every 3 days.

                      **Fixed:** Specific days of the month to retry. **Ex.** 10th, 20th, 30th.
                    enum:
                      - scheduled
                      - fixed
                  value:
                    type: array
                    minItems: 1
                    uniqueItems: true
                    default: 3
                    description: |-
                      **Examples:**

                      * "schedule": [3]
                      * "fixed": [10,20,30]
                    items:
                      type: integer
                      minimum: 1
                      maximum: 31
              metadata:
                $ref: ../models/Metadata.yaml
              fullResponse:
                type: string
                enum:
                  - v2
            required:
              - token
              - planName
              - periodicity
              - contactDetails
              - amount
              - startDate
          x-examples:
            application/json:
              token: d61d0c6385d74df68b8afb8a6dc02b24
              planName: Premium
              periodicity: monthly
              contactDetails:
                firstName: John
                lastName: Doe
                email: user@example.com
              amount:
                subtotalIva: 0
                subtotalIva0: 20000
                iva: 0
                currency: CLP
              startDate: '2022-03-20'
              language: en
              retryConfiguration:
                retryType: scheduled
                value:
                  - 7
              metadata:
                plan:
                  fitness:
                    cardio: include
                    rumba: include
                    pool: include
        - type: string
          in: header
          name: Content-Type
          description: application/json
          required: true
      x-stoplight:
        id: t2tqe4wh0cpdi
  /subscriptions/v1/card-async/preAuthorization:
    post:
      summary: Authorize payments
      operationId: post-subscriptions-v1-card-async-preAuthorization
      responses:
        '200':
          description: OK
          schema:
            type: object
            x-examples:
              example-1:
                redirectUrl: 'https://kushkipagos.com/card-async/v1/agent/df825dd6367e4142a24029805e9b4f27'
                transactionReference: 33c5d084-81bc-4b05-9078-867026a34490
            properties:
              redirectUrl:
                type: string
              transactionReference:
                type: string
            required:
              - redirectUrl
              - transactionReference
          examples:
            Successful transaction:
              redirectUrl: 'https://kushkipagos.com/card-async/v1/agent/df825dd6367e4142a24029805e9b4f27'
              transactionReference: 33c5d084-81bc-4b05-9078-867026a34490
        '400':
          description: Bad Request
          schema:
            type: object
            x-examples:
              example-1:
                code: CAS006
                message: K006 - Not Authorized
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - code
              - message
          examples:
            Not Authorized:
              code: CAS006
              message: K006 - Not Authorized
        '500':
          description: Internal Server Error
          schema:
            type: object
            x-examples:
              example-1:
                code: K002
                message: Ha ocurrido un error inesperado
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - code
              - message
          examples:
            An unexpected error has occurred:
              code: K002
              message: Ha ocurrido un error inesperado
      description: |-
        > There is a maximum time of 7 calendar days to make the capture. After that time, the amount withheld from the credit card will be released. Transbank does not allow the release of the approved amount if it is not captured within 7 days.

        Use this endpoint to request an authorization using a `token` provided by Kushki. 

        You authorize a card payment when you want to verify that sufficient credit exists on a customer's credit card before processing a sale. The cardholder's credit limit will be reduced by the amount of the authorization until the authorization is captured or expires.

        <!-- theme: warning -->
        > #### Service available in the following countries:
        >
        > Chile.  
        > Check out our full [list of services by country](https://api-docs.kushkipagos.com/docs/online-payments/services-by-country)


        > Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)
      parameters:
        - type: string
          in: header
          name: Private-key
          required: true
        - type: string
          in: header
          name: Content-Type
          description: application/json
          required: true
        - in: body
          name: body
          schema:
            type: object
            x-examples:
              example-1:
                token: 5bd8d89de5ae45acb0f1b26e4fd57858
                amount:
                  subtotalIva: 0
                  subtotalIva0: 10000.5
                  iva: 0
                metadata:
                  customerId: IB200
            properties:
              subscriptionId:
                type: string
                description: |-
                  Obtained from [Init an async card recurring charge
                  ](https://api-docs.kushkipagos.com/docs/online-payments/async-card-recurring-charges/operations/create-a-subscription-v-1-card-async-init) endpoint.
              amount:
                type: object
                required:
                  - subtotalIva
                  - subtotalIva0
                  - iva
                properties:
                  subtotalIva:
                    type: integer
                  subtotalIva0:
                    type: number
                  iva:
                    type: integer
              metadata:
                $ref: ../models/Metadata.yaml
            required:
              - subscriptionId
              - amount
          x-examples:
            application/json:
              subscriptionId: '1647545977818000'
              amount:
                subtotalIva: 0
                subtotalIva0: 10000.5
                iva: 0
              metadata:
                customerId: IB200
      x-internal: true
      x-stoplight:
        id: 3m6h0lupdus2o
  /subscriptions/v1/card-async/capture:
    post:
      summary: Capture an authorized payment
      operationId: post-subscriptions-v1-card-async-preAuthorization
      responses:
        '200':
          description: OK
          schema:
            type: object
            x-examples:
              example-1:
                redirectUrl: 'https://kushkipagos.com/card-async/v1/agent/df825dd6367e4142a24029805e9b4f27'
                transactionReference: 33c5d084-81bc-4b05-9078-867026a34490
            properties:
              redirectUrl:
                type: string
              transactionReference:
                type: string
            required:
              - redirectUrl
              - transactionReference
          examples:
            Successful transaction:
              redirectUrl: 'https://kushkipagos.com/card-async/v1/agent/df825dd6367e4142a24029805e9b4f27'
              transactionReference: 33c5d084-81bc-4b05-9078-867026a34490
        '400':
          description: Bad Request
          schema:
            type: object
            x-examples:
              example-1:
                code: CAS006
                message: K006 - Not Authorized
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - code
              - message
          examples:
            Not Authorized:
              code: CAS006
              message: K006 - Not Authorized
        '500':
          description: Internal Server Error
          schema:
            type: object
            x-examples:
              example-1:
                code: K002
                message: Ha ocurrido un error inesperado
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - code
              - message
          examples:
            An unexpected error has occurred:
              code: K002
              message: Ha ocurrido un error inesperado
      description: |-
        > There is a maximum time of 7 calendar days to make the capture. After that time, the amount withheld from the credit card will be released. Transbank does not allow the release of the approved amount if it is not captured within 7 days.

        Capture an authorized card payment using the `ticketNumber` provided as a response to the `Get status` request.

        <!-- theme: warning -->
        > #### Service available in the following countries:
        >
        > Chile.  
        > Check out our full [list of services by country](https://api-docs.kushkipagos.com/docs/online-payments/services-by-country)


        > Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)
      parameters:
        - type: string
          in: header
          name: Private-key
          required: true
        - type: string
          in: header
          name: Content-Type
          description: application/json
          required: true
        - in: body
          name: body
          schema:
            type: object
            x-examples:
              example-1:
                ticketNumber: '319228478889680318'
                amount:
                  currency: CLP
                  subtotalIva: 0
                  iva: 0
                  subtotalIva0: 600
                fullResponse: v2
            properties:
              ticketNumber:
                type: string
                description: Obtain this as a response of the **Get Status** request
              amount:
                $ref: ../models/Amount-CL.yaml
              fullResponse:
                type: string
                enum:
                  - v2
            required:
              - ticketNumber
              - amount
              - fullResponse
          x-examples:
            application/json:
              ticketNumber: '319228478889680318'
              amount:
                currency: CLP
                subtotalIva: 0
                iva: 0
                subtotalIva0: 600
              fullResponse: v2
      x-internal: true
      x-stoplight:
        id: tl1g6kyxsfjiw
    parameters: []
  '/subscriptions/v1/card/{subscriptionId}/authorize':
    parameters:
      - type: string
        name: subscriptionId
        in: path
        required: true
    post:
      summary: Authorize payments
      operationId: post-subscriptions-v1-card-subscriptionId-authorize
      responses:
        '200':
          description: OK
          schema:
            type: object
            x-examples:
              Example 1:
                details:
                  amount:
                    ice: 0
                    iva: 0
                    subtotalIva: 0
                    subtotalIva0: 1000
                    currency: MXN
                  approvalCode: '000000'
                  approvedTransactionAmount: 1000
                  binInfo:
                    bank: BANCO DE LA PRODUCCION S.A. (PRODUBANCO)
                    bindCard: '545195'
                    cardCountry: Ecuador
                    lastFourDigits: '5480'
                    type: credit
                  created: 1658358910000
                  merchantId: '20000000104111374000'
                  merchantName: Merchant MX
                  paymentBrand: Master Card
                  processorBankName: 0032~BANCO INTERNACIONAL
                  requestAmount: 1000
                  responseCode: '000'
                  responseText: Transacción aprobada
                  transactionId: '965525029987882758'
                  transactionReference: 6e595cbe-d59a-4ac5-8356-878124f15877
                  transactionStatus: APPROVAL
                  transactionType: PREAUTHORIZATION
                  maskedCreditCard: 545195XXXXXX5480
                  token: 4588fa49cfba45c984634f35613aaa70
                ticketNumber: '729169956358290082'
                subscriptionId: '1658358878997000'
            properties:
              details:
                type: object
                properties:
                  amount:
                    $ref: ../models/Amount-CL.yaml
                  approvalCode:
                    type: string
                  approvedTransactionAmount:
                    type: integer
                  binInfo:
                    type: object
                    properties:
                      bank:
                        type: string
                      binCard:
                        type: string
                        x-stoplight:
                          id: 9o42dngzc04qx
                      cardCountry:
                        type: string
                      lastFourDigits:
                        type: string
                      type:
                        type: string
                  created:
                    type: integer
                  merchantId:
                    type: string
                  merchantName:
                    type: string
                  paymentBrand:
                    type: string
                  processorBankName:
                    type: string
                  requestAmount:
                    type: integer
                  responseCode:
                    type: string
                  responseText:
                    type: string
                  transactionId:
                    type: string
                  transactionReference:
                    type: string
                  transactionStatus:
                    type: string
                    enum:
                      - APPROVAL
                      - DECLINED
                  transactionType:
                    type: string
                  maskedCreditCard:
                    type: string
                  token:
                    type: string
              ticketNumber:
                type: string
              subscriptionId:
                type: string
          examples:
            'GL: Authorize payments':
              ticketNumber: '627388610047090811'
              transactionReference: 998ba5fd-e590-4615-a84a-83b734437c57
            'CL: fullResponse v2':
              details:
                amount:
                  ice: 0
                  iva: 0
                  subtotalIva: 0
                  subtotalIva0: 1000
                  currency: CLP
                approvalCode: '000000'
                approvedTransactionAmount: 1000
                binInfo:
                  bank: BANCO DE LA PRODUCCION S.A. (PRODUBANCO)
                  bindCard: '545195'
                  cardCountry: Ecuador
                  lastFourDigits: '5480'
                  type: credit
                created: 1658358910000
                merchantId: '20000000104111374000'
                merchantName: Tu comercio CL
                paymentBrand: Master Card
                processorBankName: 0032~BANCO INTERNACIONAL
                requestAmount: 1000
                responseCode: '000'
                responseText: Transacción aprobada
                transactionId: '965525029987882758'
                transactionReference: 6e595cbe-d59a-4ac5-8356-878124f15877
                transactionStatus: APPROVAL
                transactionType: PREAUTHORIZATION
                maskedCreditCard: 545195XXXXXX5480
                token: 4588fa49cfba45c984634f35613aaa70
              ticketNumber: '729169956358290082'
              subscriptionId: '1658358878997000'
        '400':
          description: Bad Request
          schema:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            x-examples:
              Example 1:
                code: K055
                message: Tipo de moneda no permitido
          examples:
            GL - K055 - Tipo de moneda no permitido:
              code: K055
              message: Tipo de moneda no permitido
            GL - K001 - El cuerpo de la petición es inválido:
              code: K001
              message: El cuerpo de la petición es inválido
        '500':
          description: Internal Server Error
          schema:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            x-examples:
              Example 1:
                code: K002
                message: Ha ocurrido un error inesperado
          examples:
            GL - K002 - Ha ocurrido un error inesperado:
              code: K002
              message: Ha ocurrido un error inesperado
      description: |-
        > There is a maximum time of 7 calendar days to make the capture. After that time, the amount withheld from the credit card will be released. Transbank does not allow the release of the approved amount if it is not captured within 7 days.

        Use this endpoint to request an authorization on an existing async card recurring charge, identified by its `subscriptionId`, created in the **Init an async card recurring charge** endpoint.

        You authorize a credit card payment when you want to verify that sufficient credit exists on a customer's credit card before processing a sale. The cardholder's credit limit will be reduced by the amount of the authorization until the authorization is captured or expires.

        <!-- theme: warning -->
        > #### Service available in the following countries:
        >
        > Chile.  
        > Check out our full [list of services by country](https://api-docs.kushkipagos.com/docs/online-payments/services-by-country)


        > Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)
      parameters:
        - type: string
          in: header
          name: Content-Type
          description: application/json
          required: true
        - type: string
          in: header
          name: Private-key
          required: true
        - in: body
          name: body
          schema:
            type: object
            x-examples:
              Example 1:
                amount:
                  ice: 0
                  iva: 0
                  subtotalIva: 0
                  subtotalIva0: 600
                  currency: MXN
                name: John
                lastName: Doe
                email: user@example.com
                fullResponse: v2
            properties:
              amount:
                $ref: ../models/Amount-CL.yaml
              name:
                type: string
              lastName:
                type: string
              email:
                type: string
              orderDetails:
                type: object
                x-stoplight:
                  id: w9qqbec2hjgbg
                description: Required for antifraud checks
                properties:
                  siteDomain:
                    type: string
                    x-stoplight:
                      id: jy0vful6vmgr6
                  shippingDetails:
                    type: object
                    x-stoplight:
                      id: elcvsdrgvk5zs
                    description: Required for antifraud checks
                    properties:
                      name:
                        type: string
                        x-stoplight:
                          id: 4ichlyu8igh7s
                      phone:
                        type: string
                        x-stoplight:
                          id: l66029t96qk1c
                      address:
                        type: string
                        x-stoplight:
                          id: v0v5hpczbiv36
                      city:
                        type: string
                        x-stoplight:
                          id: sga4xenkby3nt
                      region:
                        type: string
                        x-stoplight:
                          id: lardwn72llxt1
                      country:
                        type: string
                        x-stoplight:
                          id: 61oy5h9kvj4xf
                      zipCode:
                        type: string
                        x-stoplight:
                          id: oacs7chu7ejvj
                  billingDetails:
                    type: object
                    x-stoplight:
                      id: gqcruiw6g60bw
                    description: Required for antifraud checks
                    properties:
                      name:
                        type: string
                        x-stoplight:
                          id: 5f0t4rh6xecsc
                      phone:
                        type: string
                        x-stoplight:
                          id: gamikh64inssz
                      address:
                        type: string
                        x-stoplight:
                          id: lpb0xr7wzq0v3
                      city:
                        type: string
                        x-stoplight:
                          id: 8eu4gbeq7t8fj
                      region:
                        type: string
                        x-stoplight:
                          id: u1ddjghwekaz1
                      country:
                        type: string
                        x-stoplight:
                          id: idxt584gsr0vm
                      zipCode:
                        type: string
                        x-stoplight:
                          id: 4wa59olwddcrk
              fullResponse:
                type: string
                enum:
                  - v2
            required:
              - amount
              - name
              - lastName
              - email
          x-examples:
            Authorize payments:
              amount:
                ice: 0
                iva: 0
                subtotalIva: 0
                subtotalIva0: 600
                currency: CLP
              name: John
              lastName: Doe
              email: user@example.com
              fullResponse: v2
      x-stoplight:
        id: 2nqp5975wbrn6
  '/subscriptions/v1/card/{subscriptionId}/capture':
    parameters:
      - type: string
        name: subscriptionId
        in: path
        required: true
    post:
      summary: Capture an authorized payment
      operationId: post-subscriptions-v1-card-subscriptionId-capture
      responses:
        '200':
          description: OK
          schema:
            type: object
            x-examples:
              Example 1:
                details:
                  approvalCode: '000000'
                  approvedTransactionAmount: 1000
                  binInfo:
                    bank: BANCO DE LA PRODUCCION S.A. (PRODUBANCO)
                    type: ''
                    binCard: '545195'
                    lastFourDigits: '5480'
                  merchantId: '20000000104111374000'
                  merchantName: Merchant MX
                  paymentBrand: Master Card
                  preauthTransactionReference: ece6bc01-b639-4338-9d40-6e0baa6cd48b
                  processorBankName: 0032~BANCO INTERNACIONAL
                  responseCode: '000'
                  responseText: Transacción aprobada
                  ticketNumber: '605303508109325273'
                  transactionReference: ece6bc01-b639-4338-9d40-6e0baa6cd48b
                  transactionType: CAPTURE
                  amount:
                    currency: MXN
                    subtotalIva: 0
                    iva: 0
                    subtotalIva0: 1000
                    ice: 0
                  created: 1658358438000
                  requestAmount: 1000
                  transactionStatus: APPROVAL
                ticketNumber: '605303508109325273'
                transactionReference: ece6bc01-b639-4338-9d40-6e0baa6cd48b
            properties:
              details:
                type: object
                properties:
                  approvalCode:
                    type: string
                  approvedTransactionAmount:
                    type: integer
                  binInfo:
                    type: object
                    properties:
                      bank:
                        type: string
                      type:
                        type: string
                      binCard:
                        type: string
                      lastFourDigits:
                        type: string
                  merchantId:
                    type: string
                  merchantName:
                    type: string
                  paymentBrand:
                    type: string
                  preauthTransactionReference:
                    type: string
                  processorBankName:
                    type: string
                  responseCode:
                    type: string
                  responseText:
                    type: string
                  ticketNumber:
                    type: string
                  transactionReference:
                    type: string
                  transactionType:
                    type: string
                  amount:
                    $ref: ../models/Amount-CL.yaml
                  created:
                    type: integer
                  requestAmount:
                    type: integer
                  transactionStatus:
                    type: string
              ticketNumber:
                type: string
              transactionReference:
                type: string
          examples:
            GL - fullResponse v2:
              details:
                approvalCode: '000000'
                approvedTransactionAmount: 600
                binInfo:
                  bank: BANCO DE LA PRODUCCION S.A. (PRODUBANCO)
                  type: ''
                  binCard: '545195'
                  lastFourDigits: '5480'
                merchantId: '20000000104111374001'
                merchantName: Tu comercio CL
                paymentBrand: Master Card
                preauthTransactionReference: ece6bc01-b639-4338-9d40-6e0baa6cd48b
                processorBankName: 0032~BANCO INTERNACIONAL
                responseCode: '000'
                responseText: Transacción aprobada
                ticketNumber: '605303508109325273'
                transactionReference: ece6bc01-b639-4338-9d40-6e0baa6cd48b
                transactionType: CAPTURE
                amount:
                  currency: CLP
                  subtotalIva: 0
                  iva: 0
                  subtotalIva0: 600
                  ice: 0
                created: 1658358438000
                requestAmount: 600
                transactionStatus: APPROVAL
              ticketNumber: '605303508109325273'
              transactionReference: ece6bc01-b639-4338-9d40-6e0baa6cd48b
            GL - Single response:
              ticketNumber: '103836286199869975'
              transactionReference: bc477fc9-bfe7-4a4e-aadf-36f0c377e959
        '400':
          description: Bad Request
          schema:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            x-examples:
              Example 1:
                code: K042
                message: El código de moneda es diferente al de la transacción inicial.
          examples:
            GL - K042 - El código de moneda es diferente al de la transacción inicial.:
              code: K042
              message: El código de moneda es diferente al de la transacción inicial.
            GL - K001 - El cuerpo de la petición es inválido:
              code: K001
              message: El cuerpo de la petición es inválido
            GL - K004 - Id de comercio no válido.:
              code: K004
              message: Id de comercio no válido.
        '500':
          description: Internal Server Error
          schema:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            x-examples:
              Example 1:
                code: K002
                message: Ha ocurrido un error inesperado
          examples:
            GL - K002 - Ha ocurrido un error inesperado:
              code: K002
              message: Ha ocurrido un error inesperado
      description: |-
        > There is a maximum time of 7 calendar days to make the capture. After that time, the amount withheld from the credit card will be released. Transbank does not allow the release of the approved amount if it is not captured within 7 days.

        Capture an authorized credit-card payment using the `ticketNumber` provided as a response to the `authorization` request.

        <!-- theme: warning -->
        > #### Service available in the following countries:
        >
        > Chile.  
        > Check out our full [list of services by country](https://api-docs.kushkipagos.com/docs/online-payments/services-by-country)


        > Got a suggestion on this documentation? [Contact Us.](mailto:techwriting@kushki.com)
      parameters:
        - type: string
          in: header
          name: Content-Type
          required: true
          description: application/json
        - type: string
          in: header
          name: Private-key
          required: true
        - in: body
          name: body
          schema:
            type: object
            x-examples:
              Example 1:
                ticketNumber: '319228478889680318'
                amount:
                  currency: MXN
                  subtotalIva: 0
                  iva: 0
                  subtotalIva0: 600
                  ice: 0
                fullResponse: v2
            properties:
              ticketNumber:
                type: string
              amount:
                $ref: ../models/Amount-CL.yaml
              fullResponse:
                type: string
                enum:
                  - v2
            required:
              - ticketNumber
              - amount
          x-examples:
            Capture an authorized payment:
              ticketNumber: '319228478889680319'
              amount:
                currency: CLP
                subtotalIva: 0
                iva: 0
                subtotalIva0: 600
                ice: 0
              fullResponse: v2
      x-stoplight:
        id: sprlwokzl25u4
responses:
  'trait:invalidBin:402':
    description: Invalid Bin
    schema:
      $ref: '#/definitions/InvalidBinResponse'
  'trait:badRequest:400':
    description: Bad Request
    schema:
      $ref: '#/definitions/BadRequestResponse'
  'trait:fetchedList:200':
    description: Fetch a transactions list
    schema:
      type: object
      required:
        - has_more
        - data
      properties:
        has_more:
          type: boolean
          example: true
        data:
          type: array
          items:
            required:
              - subtotalIVA0
              - date
              - lastFourDigitsOfCard
              - transactionStatus
              - transactionId
              - voidedBy
              - merchantName
              - cardHolderName
              - approvedTransactionAmount
              - numberOfMonths
              - extraTaxes
              - saleTicketNumber
              - ivaValue
              - isDeferred
              - ticketNumber
              - id
              - dateAndTimeTransaction
              - cardType
              - subtotalIVA
              - requestAmount
              - currencyCode
              - transactionType
              - processorName
              - iceValue
              - merchantId
              - processorBankName
              - approvalCode
            properties:
              subtotalIVA0:
                type: number
                example: 10
              date:
                type: string
                example: '2017-03-24T18:52:34.000Z'
              lastFourDigitsOfCard:
                type: string
                example: 1234
              transactionStatus:
                type: string
                example: APPROVAL
              transactionId:
                type: string
                example: 1234567890987654
              voidedBy:
                type: string
                example: 10334120439012934
              merchantName:
                type: string
                example: Some_Merchant_Name
              cardHolderName:
                type: string
                example: John Doe
              approvedTransactionAmount:
                type: string
                example: 135.5
              numberOfMonths:
                type: string
                example: 0
              extraTaxes:
                type: array
                items:
                  required:
                    - tasaAeroportuaria
                    - agenciaDeViaje
                    - iac
                  properties:
                    tasaAeroportuaria:
                      type: object
                      properties:
                        taxid:
                          type: string
                          example: '4'
                        taxAmount:
                          type: string
                          example: 2
                        taxName:
                          type: string
                          example: TASA_AERO
                    iac:
                      type: object
                      properties:
                        taxid:
                          type: string
                          example: '5'
                        taxAmount:
                          type: string
                          example: 2
                        taxName:
                          type: string
                          example: IAC
                    agenciaDeViaje:
                      type: object
                      properties:
                        taxid:
                          type: string
                          example: '6'
                        taxAmount:
                          type: string
                          example: 2
                        taxName:
                          type: string
                          example: TASA_ADMIN_AGEN_COD
              saleTicketNumber:
                type: string
                example: 1204493249523
              ivaValue:
                type: integer
                example: 15.5
              isDeferred:
                type: string
                example: 'Y'
              ticketNumber:
                type: string
                example: 1234567890987654
              id:
                type: string
                example: '123456'
              dateAndTimeTransaction:
                type: string
                example: 12345012469
              cardType:
                type: string
                example: Master Card
              subtotalIVA:
                type: number
                example: 10
              requestAmount:
                type: string
                example: 130
              currencyCode:
                type: string
                example: USD
              transactionType:
                type: string
                example: SALE
              processorName:
                type: string
                example: Some_Processor_Name
              iceValue:
                type: number
                example: 10
              merchantId:
                type: string
                example: 1200000432450023
              processorBankName:
                type: string
                example: Some_Bank_Name
              approvalCode:
                type: string
                example: 342347
              Metadata:
                type: object
                properties:
                  key1:
                    type: string
                    example: value1
              subscription_metadata:
                type: object
                properties:
                  key2:
                    type: string
                    example: value2
    examples:
      example-1:
        has_more: true
        data:
          - subtotalIVA0: 10
            date: '2017-03-24T18:52:34.000Z'
            lastFourDigitsOfCard: 1234
            transactionStatus: APPROVAL
            transactionId: 1234567890987654
            voidedBy: 10334120439012934
            merchantName: Some_Merchant_Name
            cardHolderName: John Doe
            approvedTransactionAmount: 135.5
            numberOfMonths: 0
            ExtraTaxes:
              - tasaAeroportuaria:
                  taxid: '4'
                  taxAmount: 2
                  taxName: TASA_AERO
                iac:
                  taxid: '5'
                  taxAmount: 2
                  taxName: IAC
                agenciaDeViaje:
                  taxid: '6'
                  taxAmount: 2
                  taxName: TASA_ADMIN_AGEN_COD
            saleTicketNumber: 1204493249523
            ivaValue: 15.5
            isDeferred: 'Y'
            ticketNumber: 1234567890987654
            id: '123456'
            dateAndTimeTransaction: 12345012469
            cardType: Master Card
            subtotalIVA: 10
            requestAmount: 130
            currencyCode: USD
            transactionType: SALE
            processorName: Some_Processor_Name
            iceValue: 10
            merchantId: 1200000432450023
            processorBankName: Some_Bank_Name
            approvalCode: 342347
            Metadata:
              key1: value1
            subscription_metadata:
              key2: value2
  'trait:created:201':
    description: Created
    schema:
      type: object
      required:
        - ticketNumber
      properties:
        ticketNumber:
          type: string
          example: '123456789012345678'
    examples:
      example-1:
        ticketNumber: '123456789012345678'
  'trait:unexpectedError:500':
    description: Unexpected Error
    schema:
      $ref: '#/definitions/UnexpectedErrorResponse'
  'trait:tokenCreated:201':
    description: TokenCreated
    schema:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          example: AbCDef123456Z7Ghi8901234jkLMNopQ
definitions: {}
